"use strict";(self.webpackChunkopenyurt_io=self.webpackChunkopenyurt_io||[]).push([[9742],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=r.createContext({}),d=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=d(e.components);return r.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,u=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),c=d(n),m=a,y=c["".concat(u,".").concat(m)]||c[m]||p[m]||i;return n?r.createElement(y,l(l({ref:t},s),{},{components:n})):r.createElement(y,l({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},39608:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var r=n(87462),a=(n(67294),n(3905));const i={title:"Yurtadm init"},l=void 0,o={unversionedId:"installation/yurtadm-init",id:"version-v1.2/installation/yurtadm-init",title:"Yurtadm init",description:"1. Background",source:"@site/versioned_docs/version-v1.2/installation/yurtadm-init.md",sourceDirName:"installation",slug:"/installation/yurtadm-init",permalink:"/docs/v1.2/installation/yurtadm-init",draft:!1,editUrl:"https://github.com/openyurtio/openyurt.io/edit/master/docs/installation/yurtadm-init.md",tags:[],version:"v1.2",lastUpdatedBy:"rambohe-ch",lastUpdatedAt:1675160618,formattedLastUpdatedAt:"Jan 31, 2023",frontMatter:{title:"Yurtadm init"}},u={},d=[{value:"1. Background",id:"1-background",level:2},{value:"2. Process",id:"2-process",level:2},{value:"2.1 Compile yurtadm",id:"21-compile-yurtadm",level:3},{value:"2.2 Yurtadm init",id:"22-yurtadm-init",level:3},{value:"3. Implementation details",id:"3-implementation-details",level:2}],s={toc:d};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"1-background"},"1. Background"),(0,a.kt)("p",null,"In order to allow users to quickly obtain an OpenYurt test cluster, OpenYurt provides the command Yurtadm init to initialize the cluster. Users only need to select the version of the OpenYurt cluster mirror to create the corresponding version of OpenYurt. Then Yurt-APP-Manager, Yurt-Controller-Manager, Yurttunnel -Server, Yurttunnel-Agent components will be automatically deployed."),(0,a.kt)("p",null,"To expand the cluster later, users can use the Yurtadm join command to add edge nodes or cloud nodes to the cluster."),(0,a.kt)("h2",{id:"2-process"},"2. Process"),(0,a.kt)("h3",{id:"21-compile-yurtadm"},"2.1 Compile yurtadm"),(0,a.kt)("p",null,"When initializing the cluster, you need to obtain the Yurtadm executable first. To quickly build and install yurtadm, you can execute the following command to complete the installation if the build system has golang at least 1.13 up to 1.17 and bash installed:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'git clone https://github.com/openyurtio/openyurt.git\ncd openyurt\nmake build WHAT="yurtadm" ARCH="amd64" REGION=cn\n')),(0,a.kt)("p",null,"The executable will be stored in the ",(0,a.kt)("inlineCode",{parentName:"p"},"_output/local/bin/linux/amd64/")," directory, depends on the platform."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cp _output/local/bin/linux/amd64/yurtadm /usr/local/bin/\n")),(0,a.kt)("h3",{id:"22-yurtadm-init"},"2.2 Yurtadm init"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"yurtadm init")," can initialize an openyurt cluster with the latest version (the current kubernetes version is 1.22.8)."),(0,a.kt)("p",null,"Example\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"yurtadm init --apiserver-advertise-address=47.115.228.119 --yurt-tunnel-server-address=47.115.228.119 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12\n")),(0,a.kt)("p",null,"Explanation of parameters:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--apiserver-advertise-address"),"\uff1aThe ip address of the master node of the cluster to be installed"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--yurt-tunnel-server-address"),"\uff1aThe address of yurt-tunnel-server"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--pod-network-cidr"),"\uff1aPodSubnet"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--service-cidr"),"\uff1aServiceSubnet")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"yurtadm init")," installs the cluster using sealer. This process automatically installs the following components:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"kubeadm"),(0,a.kt)("li",{parentName:"ul"},"kubectl"),(0,a.kt)("li",{parentName:"ul"},"kubelet"),(0,a.kt)("li",{parentName:"ul"},"kube-proxy"),(0,a.kt)("li",{parentName:"ul"},"docker")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Additional Operations")),(0,a.kt)("p",null,"The k8s base image in sealer (current v0.8.6 version) will be stored in the sea.hub:5000 registry, so the ",(0,a.kt)("inlineCode",{parentName:"p"},"sea.hub:5000/kube-proxy:v1.22.8")," image pull of the edge node will be ImagePullBackOff. So here you need to manually ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl edit ds kube-proxy -n kube-system"),", and replace the image with ",(0,a.kt)("inlineCode",{parentName:"p"},"registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.22.8")),(0,a.kt)("h2",{id:"3-implementation-details"},"3. Implementation details"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"yurtadm init")," is implemented using ",(0,a.kt)("inlineCode",{parentName:"p"},"sealer run"),"."),(0,a.kt)("p",null,"The related files of the openyurt cluster image produced by sealer will be placed in the ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/lib/sealer/data/my-cluster/rootfs")," directory. See all file related information: \uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/windydayc/openyurt-cluster-image"},"https://github.com/windydayc/openyurt-cluster-image")))}p.isMDXComponent=!0}}]);