"use strict";(self.webpackChunkopenyurt_io=self.webpackChunkopenyurt_io||[]).push([[1606],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=p(e,["components","mdxType","originalType","parentName"]),c=s(t),m=r,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return t?a.createElement(h,i(i({ref:n},u),{},{components:t})):a.createElement(h,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=c;var p={};for(var l in n)hasOwnProperty.call(n,l)&&(p[l]=n[l]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<o;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},86501:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>p,toc:()=>s});var a=t(87462),r=(t(67294),t(3905));const o={title:"YurtAppOverrider"},i=void 0,p={unversionedId:"user-manuals/workload/yurt-app-overrider",id:"user-manuals/workload/yurt-app-overrider",title:"YurtAppOverrider",description:"Background",source:"@site/docs/user-manuals/workload/yurt-app-overrider.md",sourceDirName:"user-manuals/workload",slug:"/user-manuals/workload/yurt-app-overrider",permalink:"/docs/next/user-manuals/workload/yurt-app-overrider",draft:!1,editUrl:"https://github.com/openyurtio/openyurt.io/edit/master/docs/user-manuals/workload/yurt-app-overrider.md",tags:[],version:"current",lastUpdatedBy:"vie-serendipity",lastUpdatedAt:1697004095,formattedLastUpdatedAt:"Oct 11, 2023",frontMatter:{title:"YurtAppOverrider"},sidebar:"docs",previous:{title:"YurtAppDaemon",permalink:"/docs/next/user-manuals/workload/yurt-app-daemon"},next:{title:"YurtStaticSet",permalink:"/docs/next/user-manuals/workload/yurt-static-set"}},l={},s=[{value:"Background",id:"background",level:2},{value:"Usage",id:"usage",level:2},{value:"1. Deploy OpenYurt",id:"1-deploy-openyurt",level:3},{value:"2. User Stories",id:"2-user-stories",level:3}],u={toc:s};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"We already had YurtAppDaemon and YurtAppSet in the context of multi-region, but they fell short in their ability to customize configurations. To reduce coupling and for backward compatibility, we introduced YurtAppOverrider for personalized rendering, and to simplify configuration, we categorize its capabilities into basic rendering (image and replicas) and advanced rendering (arbitrary fields)."),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"1-deploy-openyurt"},"1. Deploy OpenYurt"),(0,r.kt)("p",null,"The yurt-app-overrider controller and webhook is integrated within Yurt-Manager component. Before using, OpenYurt needs to be installed and deployed. You can refer to ",(0,r.kt)("a",{parentName:"p",href:"https://openyurt.io/docs/installation/manually-setup/#32-setup-openyurtopenyurt-components"},"Deploy OpenYurt")," for detailed operations."),(0,r.kt)("h3",{id:"2-user-stories"},"2. User Stories"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Creating a YurtAppOverrider bound to an existing resource")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps.openyurt.io/v1alpha1\nkind: YurtAppOverrider\nmetadata:\n  namespace: default\n  name: demo1\nsubject:\n  kind: YurtAppSet\n  name: yurtappset-demo\nentries:\n")),(0,r.kt)("p",null,"We ignore entries field for now and focuses on subject field in the configuration above. Subject field indicates that the created YurtAppOverrider will be bound to the resource with the specified kind and name in its namespace."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Customized replicas and image (basic rendering)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps.openyurt.io/v1alpha1\nkind: YurtAppOverrider\nmetadata:\n  namespace: default\n  name: demo1\nsubject:\n  kind: YurtAppSet\n  name: yurtappset-demo\nentries:\n- pools:\n    beijing\n    hangzhou\n  items:\n  - image:\n      containerName: nginx\n      imageClaim: nginx:1.14.2\n  - replicas: 3\n- pools:\n    shanghai\n  items:\n  - image:\n      containerName: nginx\n      imageClaim: nginx:1.13.2\n  - replicas: 5\n")),(0,r.kt)("p",null,"With the above configuration, we can configure the replicas in the Beijing Hangzhou node pool to 3 and the image version to 1.14.2, and we can configure the replicas in the Shanghai node pool to 5 and the image version to 1.13.2."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Implementing hostPath changes (advanced rendering)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps.openyurt.io/v1alpha1\nkind: YurtAppOverrider\nmetadata:\n  namespace: default\n  name: demo1\nsubject:\n  kind: YurtAppSet\n  name: yurtappset-demo\nentries:\n- pools:\n    hangzhou\n  patches:\n  - operation: add\n    path: /spec/template/spec/volumes/-\n    value:\n      name: test-volume\n      hostPath:\n        path: /var/lib/docker\n        type: Directory\n  - operation: replace\n    path: /spec/template/spec/containers/0/volumeMounts/-\n    value:\n      name: shared-dir\n      mountPath: /var/lib/docker\n- pools:\n    beijing\n  patches:\n  - operation: add\n    path: /spec/template/spec/volumes/-\n    value:\n      name: test-volume\n      hostPath:\n        path: /data/logs\n        type: Directory\n  - operation: replace\n    path: /spec/template/spec/containers/0/volumeMounts/-\n    value:\n      name: shared-dir\n      mountPath: /data/logs\n")),(0,r.kt)("p",null,"The above patches field allows us to personalize the hostpath for different node pools. Each patch consists of operation, path, and value, and can add, remove, and replace any of the fields, with syntax rules conforming to the syntax of json-patch."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Other features")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps.openyurt.io/v1alpha1\nkind: YurtAppOverrider\nmetadata:\n  namespace: default\n  name: demo1\nsubject:\n  kind: YurtAppSet\n  name: yurtappset-demo\nentries:\n- pools:\n    '*'\n    '-beijing'\n  patches:\n  - operation: add\n    path: /spec/template/spec/volumes/-\n    value:\n      name: foo\n      configMap:\n        name: configmap-{{nodepool}}\n")),(0,r.kt)("p",null,"With the above configuration, we can add configmap corresponding to every node pool (except Beijing node pool). To simplify the configuration, we can use ",(0,r.kt)("inlineCode",{parentName:"p"},"'*'")," to indicate all node pools, and we can add ",(0,r.kt)("inlineCode",{parentName:"p"},"-")," in front of a node pool's name to indicate the removal of that node pool. In addition, we can match node pools with ",(0,r.kt)("inlineCode",{parentName:"p"},"{{nodepool}}")," to do bulk configuration. (Note: If we use bulk configuration, the corresponding configmap needs to follow certain naming conventions, i.e., replace ",(0,r.kt)("inlineCode",{parentName:"p"},"{{nodepool}}")," with the actual node pool name)."))}d.isMDXComponent=!0}}]);